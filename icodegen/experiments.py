# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/02_experiments.ipynb (unless otherwise specified).

__all__ = ['get_mean_probs']

# Cell
import matplotlib.pyplot as plt
plt.style.use('ggplot')

import numpy as np
import tensorflow as tf

from ds4se.mgmnt.prep.i import jsonl_list_to_dataframe, get_dfs
from .model import *
from pathlib import Path
from transformers import GPT2Tokenizer, TFGPT2LMHeadModel

# Cell
# TODO: make it specific for types of tokens because this just gets overall mean regardless of if the tokens was in the method and therefore could tank the mean prob for that token
def get_mean_probs(df, model):
    mean_probs = []
    for mthd in df.code.values[:10]:
        probs = model.get_probs(mthd)[0]
        mean_prob = tf.math.reduce_mean(probs, axis = 0)
        mean_probs.append(mean_prob)

    mean_probs = tf.convert_to_tensor(mean_probs)
    mean_probs = tf.reduce_mean(mean_probs, axis = 0)
    return mean_probs